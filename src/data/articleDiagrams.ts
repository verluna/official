import { ArticleDiagramConfig } from "@/components/blog/ArticleDiagram";

/**
 * Article-specific architecture diagrams
 * Each diagram follows the pattern: Input (blue) → Processing (purple) → Output (green)
 * ViewBox is 760x280, use x: 80-680 and y: 70-210 for node positioning
 */
export const articleDiagrams: Record<string, ArticleDiagramConfig> = {
  // Article 1: Pipeline Data Quality
  "why-your-sales-pipeline-data-is-broken": {
    id: "pipeline-decay",
    title: "Pipeline Data Decay Detection",
    description: "Automated detection and remediation of zombie deals, date pushers, and stage stagnation",
    nodes: [
      {
        id: "crm",
        label: "CRM Data",
        subLabel: "Salesforce",
        x: 80,
        y: 140,
        color: "blue",
        delay: 0,
        specs: { type: "Source", execution: "Real-time", status: "Active" },
      },
      {
        id: "zombie",
        label: "Zombie Detect",
        subLabel: "30+ days idle",
        x: 280,
        y: 70,
        color: "purple",
        delay: 0.4,
        specs: { type: "SQL Query", execution: "Daily", status: "Active" },
      },
      {
        id: "push",
        label: "Push Counter",
        subLabel: "Date changes",
        x: 280,
        y: 210,
        color: "purple",
        delay: 0.5,
        specs: { type: "History Scan", execution: "Daily", status: "Active" },
      },
      {
        id: "anomaly",
        label: "Anomaly ML",
        subLabel: "Isolation Forest",
        x: 480,
        y: 140,
        color: "purple",
        delay: 0.8,
        specs: { type: "Python", execution: "Batch", status: "Active" },
      },
      {
        id: "alert",
        label: "Alert",
        subLabel: "Manager Review",
        x: 680,
        y: 70,
        color: "green",
        delay: 1.1,
        specs: { type: "Slack", execution: "Instant", status: "Active" },
      },
      {
        id: "autoclose",
        label: "Auto-Close",
        subLabel: "90 day rule",
        x: 680,
        y: 210,
        color: "green",
        delay: 1.2,
        specs: { type: "Automation", execution: "Daily", status: "Active" },
      },
    ],
    edges: [
      { from: "crm", to: "zombie", delay: 0.2 },
      { from: "crm", to: "push", delay: 0.25 },
      { from: "zombie", to: "anomaly", delay: 0.6 },
      { from: "push", to: "anomaly", delay: 0.65 },
      { from: "anomaly", to: "alert", delay: 0.95 },
      { from: "anomaly", to: "autoclose", delay: 1.0 },
    ],
  },

  // Article 2: Revenue SSOT
  "building-a-single-source-of-truth-for-revenue": {
    id: "ssot-revenue",
    title: "Revenue Single Source of Truth",
    description: "ELT pipeline unifying CRM, billing, and ERP into warehouse-native revenue models",
    nodes: [
      {
        id: "sf",
        label: "Salesforce",
        subLabel: "CRM",
        x: 60,
        y: 70,
        color: "blue",
        delay: 0,
        specs: { type: "Source", execution: "Fivetran", status: "Active" },
      },
      {
        id: "stripe",
        label: "Stripe",
        subLabel: "Billing",
        x: 60,
        y: 140,
        color: "blue",
        delay: 0.1,
        specs: { type: "Source", execution: "Fivetran", status: "Active" },
      },
      {
        id: "netsuite",
        label: "NetSuite",
        subLabel: "ERP",
        x: 60,
        y: 210,
        color: "blue",
        delay: 0.2,
        specs: { type: "Source", execution: "Fivetran", status: "Active" },
      },
      {
        id: "warehouse",
        label: "Snowflake",
        subLabel: "Data Warehouse",
        x: 280,
        y: 140,
        color: "purple",
        delay: 0.5,
        specs: { type: "Storage", execution: "Batch", status: "Active" },
      },
      {
        id: "dbt",
        label: "dbt",
        subLabel: "Transform",
        x: 480,
        y: 140,
        color: "purple",
        delay: 0.8,
        specs: { type: "SQL Models", execution: "Hourly", status: "Active" },
      },
      {
        id: "arrModel",
        label: "fct_mrr_daily",
        subLabel: "SSOT",
        x: 680,
        y: 140,
        color: "green",
        delay: 1.1,
        specs: { type: "Mart", execution: "Authoritative", status: "Active" },
      },
    ],
    edges: [
      { from: "sf", to: "warehouse", delay: 0.3 },
      { from: "stripe", to: "warehouse", delay: 0.35 },
      { from: "netsuite", to: "warehouse", delay: 0.4 },
      { from: "warehouse", to: "dbt", delay: 0.6 },
      { from: "dbt", to: "arrModel", delay: 0.95 },
    ],
  },

  // Article 3: Data Enrichment
  "automated-data-enrichment-beyond-clearbit-and-apollo": {
    id: "waterfall-enrichment",
    title: "Waterfall Data Enrichment",
    description: "Multi-provider enrichment pipeline with caching and conflict resolution",
    nodes: [
      {
        id: "lead",
        label: "New Lead",
        subLabel: "Inbound",
        x: 80,
        y: 140,
        color: "blue",
        delay: 0,
        specs: { type: "Webhook", execution: "Real-time", status: "Active" },
      },
      {
        id: "cache",
        label: "Cache Check",
        subLabel: "7-day TTL",
        x: 230,
        y: 140,
        color: "purple",
        delay: 0.3,
        specs: { type: "Postgres", execution: "5ms", status: "Active" },
      },
      {
        id: "clearbit",
        label: "Clearbit",
        subLabel: "Provider A",
        x: 380,
        y: 70,
        color: "purple",
        delay: 0.5,
        specs: { type: "API", execution: "200ms", status: "Active" },
      },
      {
        id: "apollo",
        label: "Apollo",
        subLabel: "Provider B",
        x: 380,
        y: 140,
        color: "purple",
        delay: 0.6,
        specs: { type: "API", execution: "350ms", status: "Fallback" },
      },
      {
        id: "zoominfo",
        label: "ZoomInfo",
        subLabel: "Provider C",
        x: 380,
        y: 210,
        color: "purple",
        delay: 0.7,
        specs: { type: "API", execution: "400ms", status: "Premium" },
      },
      {
        id: "merge",
        label: "Merge",
        subLabel: "Conflict Resolve",
        x: 530,
        y: 140,
        color: "purple",
        delay: 0.9,
        specs: { type: "n8n", execution: "50ms", status: "Active" },
      },
      {
        id: "crm",
        label: "CRM Update",
        subLabel: "HubSpot",
        x: 680,
        y: 140,
        color: "green",
        delay: 1.1,
        specs: { type: "API", execution: "150ms", status: "Active" },
      },
    ],
    edges: [
      { from: "lead", to: "cache", delay: 0.15 },
      { from: "cache", to: "clearbit", delay: 0.35 },
      { from: "cache", to: "apollo", delay: 0.4 },
      { from: "cache", to: "zoominfo", delay: 0.45 },
      { from: "clearbit", to: "merge", delay: 0.75 },
      { from: "apollo", to: "merge", delay: 0.8 },
      { from: "zoominfo", to: "merge", delay: 0.85 },
      { from: "merge", to: "crm", delay: 1.0 },
    ],
  },

  // Article 4: AI Agents in GTM
  "when-not-to-use-ai-agents-in-gtm": {
    id: "agent-framework",
    title: "AI Automation Spectrum",
    description: "Decision framework: when to use rules, copilots, or bounded agents in GTM",
    nodes: [
      {
        id: "input",
        label: "GTM Task",
        subLabel: "Inbound",
        x: 80,
        y: 140,
        color: "blue",
        delay: 0,
        specs: { type: "Request", execution: "Varies", status: "Active" },
      },
      {
        id: "classify",
        label: "Intent Router",
        subLabel: "Semantic",
        x: 230,
        y: 140,
        color: "purple",
        delay: 0.3,
        specs: { type: "Classifier", execution: "50ms", status: "Active" },
      },
      {
        id: "rule",
        label: "Rule-Based",
        subLabel: "Deterministic",
        x: 430,
        y: 50,
        color: "green",
        delay: 0.6,
        specs: { type: "n8n/Zapier", execution: "Low Risk", status: "Safe" },
      },
      {
        id: "copilot",
        label: "Copilot",
        subLabel: "Human Review",
        x: 430,
        y: 140,
        color: "purple",
        delay: 0.7,
        specs: { type: "LLM Draft", execution: "Med Risk", status: "Guided" },
      },
      {
        id: "agent",
        label: "Bounded Agent",
        subLabel: "Guardrailed",
        x: 430,
        y: 230,
        color: "purple",
        delay: 0.8,
        specs: { type: "LLM + Limits", execution: "High Risk", status: "Watch" },
      },
      {
        id: "exec",
        label: "Execute",
        subLabel: "Action",
        x: 630,
        y: 50,
        color: "green",
        delay: 1.0,
        specs: { type: "Automated", execution: "Immediate", status: "Active" },
      },
      {
        id: "review",
        label: "Human",
        subLabel: "Approval",
        x: 630,
        y: 140,
        color: "green",
        delay: 1.1,
        specs: { type: "Queue", execution: "Manual", status: "Required" },
      },
      {
        id: "circuit",
        label: "Circuit Break",
        subLabel: "Safety",
        x: 630,
        y: 230,
        color: "green",
        delay: 1.2,
        specs: { type: "Limit", execution: "On Threshold", status: "Active" },
      },
    ],
    edges: [
      { from: "input", to: "classify", delay: 0.15 },
      { from: "classify", to: "rule", delay: 0.4 },
      { from: "classify", to: "copilot", delay: 0.45 },
      { from: "classify", to: "agent", delay: 0.5 },
      { from: "rule", to: "exec", delay: 0.8 },
      { from: "copilot", to: "review", delay: 0.9 },
      { from: "agent", to: "circuit", delay: 0.95 },
    ],
  },

  // Article 5: Multi-Touch Attribution
  "multi-touch-attribution-without-50k-platform": {
    id: "diy-attribution",
    title: "Warehouse-Native Attribution",
    description: "Building MTA from first-party data: collection, sessionization, and attribution spine",
    nodes: [
      {
        id: "collect",
        label: "RudderStack",
        subLabel: "Collection",
        x: 80,
        y: 70,
        color: "blue",
        delay: 0,
        specs: { type: "Events", execution: "Real-time", status: "Active" },
      },
      {
        id: "ads",
        label: "Ad Platforms",
        subLabel: "Spend Data",
        x: 80,
        y: 210,
        color: "blue",
        delay: 0.1,
        specs: { type: "Airbyte", execution: "Daily", status: "Active" },
      },
      {
        id: "warehouse",
        label: "Snowflake",
        subLabel: "Storage",
        x: 280,
        y: 140,
        color: "purple",
        delay: 0.4,
        specs: { type: "Raw Events", execution: "Batch", status: "Active" },
      },
      {
        id: "sessions",
        label: "Sessionize",
        subLabel: "dbt Model",
        x: 430,
        y: 70,
        color: "purple",
        delay: 0.6,
        specs: { type: "SQL", execution: "Hourly", status: "Active" },
      },
      {
        id: "identity",
        label: "Identity Map",
        subLabel: "dbt Model",
        x: 430,
        y: 210,
        color: "purple",
        delay: 0.7,
        specs: { type: "SQL", execution: "Hourly", status: "Active" },
      },
      {
        id: "spine",
        label: "Attribution",
        subLabel: "Spine Join",
        x: 580,
        y: 140,
        color: "purple",
        delay: 0.9,
        specs: { type: "dbt Model", execution: "Hourly", status: "Active" },
      },
      {
        id: "report",
        label: "Channel ROI",
        subLabel: "U-Shaped MTA",
        x: 730,
        y: 140,
        color: "green",
        delay: 1.1,
        specs: { type: "Metabase", execution: "Dashboard", status: "Active" },
      },
    ],
    edges: [
      { from: "collect", to: "warehouse", delay: 0.2 },
      { from: "ads", to: "warehouse", delay: 0.25 },
      { from: "warehouse", to: "sessions", delay: 0.5 },
      { from: "warehouse", to: "identity", delay: 0.55 },
      { from: "sessions", to: "spine", delay: 0.75 },
      { from: "identity", to: "spine", delay: 0.8 },
      { from: "spine", to: "report", delay: 1.0 },
    ],
  },

  // Article 6: HubSpot API
  "hubspot-api-complete-engineering-guide": {
    id: "hubspot-integration",
    title: "Production HubSpot Integration",
    description: "Hybrid REST/GraphQL pattern with rate limiting, webhooks, and reconciliation",
    nodes: [
      {
        id: "app",
        label: "Your App",
        subLabel: "Backend",
        x: 80,
        y: 140,
        color: "blue",
        delay: 0,
        specs: { type: "Node.js", execution: "Real-time", status: "Active" },
      },
      {
        id: "graphql",
        label: "GraphQL",
        subLabel: "Complex Reads",
        x: 280,
        y: 70,
        color: "purple",
        delay: 0.3,
        specs: { type: "Query", execution: "Single Call", status: "Active" },
      },
      {
        id: "rest",
        label: "REST API",
        subLabel: "Writes/Batch",
        x: 280,
        y: 210,
        color: "purple",
        delay: 0.4,
        specs: { type: "CRUD", execution: "Per Object", status: "Active" },
      },
      {
        id: "limiter",
        label: "Rate Limiter",
        subLabel: "Token Bucket",
        x: 430,
        y: 140,
        color: "purple",
        delay: 0.6,
        specs: { type: "100/10s", execution: "Proactive", status: "Active" },
      },
      {
        id: "hubspot",
        label: "HubSpot",
        subLabel: "CRM",
        x: 580,
        y: 140,
        color: "green",
        delay: 0.9,
        specs: { type: "Platform", execution: "Cloud", status: "Active" },
      },
      {
        id: "webhook",
        label: "Webhooks",
        subLabel: "Events",
        x: 730,
        y: 70,
        color: "green",
        delay: 1.1,
        specs: { type: "Push", execution: "Real-time", status: "Active" },
      },
      {
        id: "reconcile",
        label: "Reconcile",
        subLabel: "Safety Net",
        x: 730,
        y: 210,
        color: "green",
        delay: 1.2,
        specs: { type: "Polling", execution: "15 min", status: "Backup" },
      },
    ],
    edges: [
      { from: "app", to: "graphql", delay: 0.15 },
      { from: "app", to: "rest", delay: 0.2 },
      { from: "graphql", to: "limiter", delay: 0.45 },
      { from: "rest", to: "limiter", delay: 0.5 },
      { from: "limiter", to: "hubspot", delay: 0.75 },
      { from: "hubspot", to: "webhook", delay: 1.0 },
      { from: "hubspot", to: "reconcile", delay: 1.05 },
    ],
  },
};

/**
 * Get diagram config for a specific article slug
 */
export function getDiagramForSlug(slug: string): ArticleDiagramConfig | null {
  return articleDiagrams[slug] ?? null;
}

/**
 * Check if an article has a diagram
 */
export function hasDiagram(slug: string): boolean {
  return slug in articleDiagrams;
}
